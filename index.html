<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <meta name="description" content="Create your tile map with this online Tile Map Editor" />

    <link rel="stylesheet" href="styles.css" />
    <style>
      * {
        box-sizing: border-box;
      }

      html {
        width: 100%;
        height: 100%;
      }

      body {
        overflow: hidden;
        height: 100%;
        overscroll-behavior-y: none;
        margin: 0;
      }
    </style>
    <script src="tilemap.js"></script>

    <title>TilemapJs</title>
  </head>
  <body>
  <div id="tileMapEditor"></div>
  <script>
    function processStatus(response) {
      if (response.status === 200 || response.status === 0) {
        return Promise.resolve(response)
      }
      else {
        return Promise.reject(new Error("Error loading image"))
      }
    }
    // upload to imgur, then return the src
    function uploadImageToImgur(blob) {
      const formData = new FormData()
      formData.append('type', 'file')
      formData.append('image', blob)

      return fetch('https://api.imgur.com/3/upload.json', {
        method: 'POST',
        headers: {
          Accept: 'application/json',
          Authorization: 'Client-ID 1bddacd2afe5039'// imgur specific
        },
        body: formData
      })
              .then(processStatus)
              .then(response=>response.response.json())
    }

    console.log(window)
    const tilesetImageImgr = "https://i.imgur.com/ztwPZOI.png";
    const tilesetImageLocal = "./free.png";

    const Tilemap = TilemapJs.init("tileMapEditor",{
      tileSize:32,
      mapWidth: 20,
      tileSetImages: [tilesetImageImgr, tilesetImageLocal],
      applyButtonText: "OK",
      onApply:console.log,
      onLoadTileSetImage: (file, base64, cb) => {
        uploadImageToImgur(file).then(result=>{
          console.log("Uploaded to imgur", result)
          cb(result)
        });
        // You can write your custom load image function here and return the src
        console.log(file, base64);
        return base64
      }
    })
  </script>
  </body>
</html>
